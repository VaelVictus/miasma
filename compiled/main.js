function loadNotes(miasma){fetch("trottering_notes.php?miasma="+miasma).then((response=>response.text())).then((data=>{document.getElementById("game_notes").innerHTML=data}))}function updateButtons(slider){["prev_button","next_button","prevSlide","nextSlide"].forEach(((id,i)=>{((button_id,index)=>{const element=document.getElementById(button_id);element?element.innerHTML=slider.slider_items[index].innerHTML:console.error(`Element with id "${button_id}" not found.`)})(id,i%2==0?slider.prev_item_index:slider.next_item_index)})),$(".slider-item:visible .zoom").magnify({speed:0,magnify:1.5})}function changeFolder(folderName){const slider=document.slider;slider&&(slider.searchFolder(folderName),history.pushState({folder:folderName},"","/miasma/"+(folderName||"")),document.body.setAttribute("data-current-miasma",folderName),toggleVarietySwitcher(folderName))}function toggleVarietySwitcher(miasma){const varietySwitcher=document.getElementById("variety_switcher");["cambium","cambium2","waylemap","waylemap2"].includes(miasma)?(varietySwitcher.style.display="block",updateSwitchButtonText(miasma)):varietySwitcher.style.display="none"}function updateSwitchButtonText(miasma){const switchButton=document.getElementById("switch_variety");"cambium"===miasma?switchButton.textContent="View Alternate Cambium":"cambium2"===miasma?switchButton.textContent="View Original Cambium":"waylemap"===miasma?switchButton.textContent="View Alternate Wayle Map":"waylemap2"===miasma&&(switchButton.textContent="View Original Wayle Map")}function switchVariety(){const currentMiasma=document.body.getAttribute("data-current-miasma");let newMiasma="";"cambium"===currentMiasma?newMiasma="cambium2":"cambium2"===currentMiasma?newMiasma="cambium":"waylemap"===currentMiasma?newMiasma="waylemap2":"waylemap2"===currentMiasma&&(newMiasma="waylemap"),newMiasma&&changeFolder(newMiasma)}function openTab(evt,tabName){"game_notes"===tabName?($("#game_notes").show(),$("#game_notes_tab").addClass("active"),$("#player_notes").hide(),$("#player_notes_tab").removeClass("active")):"player_notes"===tabName&&($("#game_notes").hide(),$("#game_notes_tab").removeClass("active"),$("#player_notes").show(),$("#player_notes_tab").addClass("active"))}class Slider{constructor(slider_elem){this.slider=slider_elem,this.slider_items=slider_elem.getElementsByClassName("slider-item"),this.current_index=0,this.visible_indices=Array.from(this.slider_items).map(((_,index)=>index)),this.setIndices(),this.showSlide(this.current_index)}setIndices(){const visible_items_count=this.visible_indices.length,current_visible_index=this.visible_indices.indexOf(this.current_index);this.prev_item_index=this.visible_indices[(current_visible_index-1+visible_items_count)%visible_items_count],this.next_item_index=this.visible_indices[(current_visible_index+1)%visible_items_count],this.preloadImages()}preloadImages(){const preloadImage=index=>{const imgElement=this.slider_items[index].querySelector("img");imgElement&&imgElement.hasAttribute("loading")&&imgElement.removeAttribute("loading")};preloadImage(this.prev_item_index),preloadImage(this.next_item_index)}slide(direction){if(this.is_sliding)return;this.is_sliding=!0;const next_index="NEXT"===direction?this.next_item_index:this.prev_item_index,action_classes="NEXT"===direction?["next-item","slide-next"]:["prev-item","slide-prev"];this.slider_items[next_index].classList.add(action_classes[0]),this.slider_items[this.current_index].classList.add(action_classes[1]),this.slider_items[next_index].classList.add("active"),setTimeout((()=>{this.slider_items[next_index].classList.remove(action_classes[0]),this.slider_items[this.current_index].classList.remove(action_classes[1],"active"),this.current_index=next_index,this.showSlide(this.current_index),this.is_sliding=!1,this.setIndices(),updateButtons(this)}),10)}next(){-1!==this.visible_indices.indexOf(this.next_item_index)&&this.slide("NEXT")}prev(){-1!==this.visible_indices.indexOf(this.prev_item_index)&&this.slide("PREV")}searchFolder(folder_name){const sliderContainer=document.querySelector("#slider_container"),mobileView=document.querySelector("#mobile_view"),chooseMiasma=document.querySelector("#choose_miasma"),notes=document.querySelector("#notes");if(""===folder_name)return sliderContainer&&(sliderContainer.style.display="none"),mobileView&&(mobileView.style.display="none"),notes&&(notes.style.display="none"),void(chooseMiasma&&(chooseMiasma.style.display="block"));if(sliderContainer&&(sliderContainer.style.display="flex"),mobileView&&(mobileView.style.display="flex"),notes&&(notes.style.display="block"),chooseMiasma&&(chooseMiasma.style.display="none"),loadNotes(folder_name),this.visible_indices=[],Array.from(this.slider_items).forEach(((slide,index)=>{slide.getAttribute("data-folder")===folder_name||"all"===folder_name?(this.visible_indices.push(index),slide.style.display=""):slide.style.display="none"})),0===this.visible_indices.length)return void console.error(`No slides found for the folder "${folder_name}".`);this.current_index=this.visible_indices[0],this.setIndices(),this.showSlide(this.current_index),updateButtons(this);const isSingleSlideFolder=["hislatitude","incineration","frontispiece","vaseandcup"].includes(folder_name),prevButton=document.getElementById("prev_button"),prevButton2=document.getElementById("prevSlide"),nextButton=document.getElementById("next_button"),nextButton2=document.getElementById("nextSlide"),toggleButtonDisabled=(button,isDisabled)=>{button.classList.toggle("disabled-button",isDisabled),button.style.display=isDisabled?"none":""};toggleButtonDisabled(prevButton,isSingleSlideFolder),toggleButtonDisabled(nextButton,isSingleSlideFolder),toggleButtonDisabled(prevButton2,isSingleSlideFolder),toggleButtonDisabled(nextButton2,isSingleSlideFolder)}showSlide(index){Array.from(this.slider_items).forEach((slide=>{slide.classList.remove("active"),slide.style.display="none"}));const newSlide=this.slider_items[index];newSlide?(newSlide.classList.add("active"),newSlide.style.display="block"):console.error("Slide with specified index does not exist:",index),this.current_index=index,updateButtons(this)}}window.onpopstate=function(event){const folderFromUrl=window.location.pathname.replace(/\/$/,"").split("/miasma/")[1]||"",slider=document.slider;slider&&(slider.searchFolder(folderFromUrl),["cambium2","waylemap2"].includes(folderFromUrl)||(document.getElementById("folderSelect").value=folderFromUrl),document.body.setAttribute("data-current-miasma",folderFromUrl),toggleVarietySwitcher(folderFromUrl))},document.addEventListener("DOMContentLoaded",(function(){const slider=new Slider(document.querySelector(".slider"));document.slider=slider,document.getElementById("prevSlide").addEventListener("click",(()=>slider.prev())),document.getElementById("nextSlide").addEventListener("click",(()=>slider.next())),document.getElementById("prev_button").addEventListener("click",(()=>slider.prev())),document.getElementById("next_button").addEventListener("click",(()=>slider.next())),document.getElementById("switch_variety").addEventListener("click",(()=>switchVariety())),window.addEventListener("keydown",(event=>{"ArrowRight"===event.code?(slider.next(),event.preventDefault()):"ArrowLeft"===event.code&&(slider.prev(),event.preventDefault()),updateButtons(slider)})),document.querySelectorAll("[data-searchFolder]").forEach((li=>{li.addEventListener("click",(function(){const folderName=this.getAttribute("data-searchFolder");slider.searchFolder(folderName)}))})),document.getElementById("game_notes_tab").click();const folderFromUrl=window.location.pathname.replace(/\/$/,"").split("/miasma/")[1]||"";let selectValue=folderFromUrl;"cambium2"===folderFromUrl?selectValue="cambium":"waylemap2"===folderFromUrl&&(selectValue="waylemap"),slider.searchFolder(folderFromUrl),document.getElementById("folderSelect").value=selectValue,document.body.setAttribute("data-current-miasma",folderFromUrl),toggleVarietySwitcher(folderFromUrl),updateButtons(slider)}));